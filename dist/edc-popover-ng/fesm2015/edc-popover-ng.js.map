{"version":3,"file":"edc-popover-ng.js","sources":["../../../projects/edc-popover-ng/src/lib/config/popover-configuration-handler.ts","../../../projects/edc-popover-ng/src/lib/translate/language-codes.ts","../../../projects/edc-popover-ng/src/lib/help.service.ts","../../../projects/edc-popover-ng/src/lib/help.constants.ts","../../../projects/edc-popover-ng/src/lib/translate/edc-translation.service.ts","../../../projects/edc-popover-ng/src/lib/help.component.ts","../../../projects/edc-popover-ng/src/lib/help.module.ts","../../../projects/edc-popover-ng/src/public_api.ts","../../../projects/edc-popover-ng/src/edc-popover-ng.ts"],"sourcesContent":["\nexport abstract class PopoverConfigurationHandler {\n\n  abstract getPluginId(): string;\n\n  abstract getHelpPath(): string;\n\n  abstract getDocPath(): string;\n\n  abstract getIcon(): string;\n\n  abstract isAppendToBody(): boolean;\n\n  abstract getI18nPath(): string;\n\n}\n","export const LANGUAGE_CODES = [\n  'en', // English\n  'ar', // Arabic\n  'bg', // Bulgarian\n  'zh', // Chinese\n  'hr', // Croatian\n  'cs', // Czech\n  'da', // Danish\n  'nl', // Dutch\n  'et', // Estonian\n  'fi', // Finnish\n  'fr', // French\n  'de', // German\n  'el', // Greek\n  'he', // Hebrew\n  'hu', // Hungarian\n  'is', // Icelandic\n  'ga', // Irish\n  'it', // Italian\n  'ja', // Japanese\n  'ko', // Korean\n  'lv', // Latvian\n  'lt', // Lithuanian\n  'lb', // Luxembourgish\n  'mt', // Maltese\n  'no', // Norwegian\n  'fa', // Persian\n  'pl', // Polish\n  'pt', // Portuguese\n  'ro', // Romanian\n  'ru', // Russian\n  'sk', // Slovak\n  'sl', // Slovenian\n  'es', // Spanish\n  'sv', // Swedish\n  'tr', // Turkish\n  'vi', // Vietnamese\n];\n\n// Languages with translation contents\nexport const DEFINED_TRANSLATION_CODES = [\n  'en',\n  'fr',\n  'ru',\n  'vi',\n  'zh'\n];\n\nexport const SYS_LANG = 'en';\n","import { Injectable } from '@angular/core';\nimport { EdcClient, Helper } from 'edc-client-js';\nimport { PopoverConfigurationHandler } from './config/popover-configuration-handler';\nimport { SYS_LANG } from './translate/language-codes';\n\n@Injectable()\nexport class HelpService {\n\n  private readonly edcClient: EdcClient;\n\n  constructor(private configurationHandler: PopoverConfigurationHandler) {\n    this.edcClient = new EdcClient(configurationHandler.getDocPath(),\n      configurationHandler.getHelpPath(),\n      configurationHandler.getPluginId(),\n      true, // Context only, don't load the whole doc\n      configurationHandler.getI18nPath()\n    );\n  }\n\n  getHelp(primaryKey: string, subKey: string, pluginId?: string, lang?: string): Promise<Helper> {\n    const pluginIdentifier = pluginId || this.configurationHandler.getPluginId();\n    return this.edcClient.getHelper(primaryKey, subKey, pluginIdentifier, lang);\n  }\n\n  getContextUrl(mainKey: string, subKey: string, languageCode: string, articleIndex: number, pluginId?: string): string {\n    return this.edcClient.getContextWebHelpUrl(mainKey, subKey, languageCode, articleIndex, pluginId);\n  }\n\n  getDocumentationUrl(docId: number): string {\n    return this.edcClient.getDocumentationWebHelpUrl(docId);\n  }\n\n  getI18nUrl(): string {\n    return this.edcClient.getPopoverI18nUrl();\n  }\n\n  getPluginId(): string {\n    return this.configurationHandler.getPluginId();\n  }\n\n  getIcon(): string {\n    return this.configurationHandler.getIcon() || 'fa-question-circle-o';\n  }\n\n  getContainer(): string {\n    return this.configurationHandler.isAppendToBody() ? 'body' : '';\n  }\n\n  getDefaultLanguage(): string {\n    return (this.edcClient && this.edcClient.getDefaultLanguage && this.edcClient.getDefaultLanguage()) || SYS_LANG;\n  }\n\n  isLanguagePresent(langCode: string): boolean {\n    return this.edcClient.isLanguagePresent(langCode);\n  }\n}\n","export class HelpConstants {\n  public static readonly MESSAGE_COMING_SOON = 'Contextual help is coming soon.';\n}\n","import { HelpService } from '../help.service';\nimport { SYS_LANG } from './language-codes';\nimport { Injectable } from '@angular/core';\n\n@Injectable()\nexport class EdcTranslationService {\n\n  defaultLanguage = SYS_LANG;\n  lang = SYS_LANG;\n\n  constructor(private readonly helpService: HelpService) {\n  }\n\n  getLang(): string {\n    return this.lang;\n  }\n\n  setLang(lang: string): void {\n    this.lang = lang;\n  }\n}\n","import { Component, OnInit, Input, OnChanges, SimpleChanges } from '@angular/core';\nimport { Helper, Link } from 'edc-client-js';\nimport { HelpService } from './help.service';\nimport { HelpConstants } from './help.constants';\nimport { SYS_LANG } from './translate/language-codes';\nimport { EdcTranslationService } from './translate/edc-translation.service';\n\n@Component({\n  selector: 'edc-help',\n  styleUrls: ['help.less'],\n  template: `<i class=\"fa help-icon {{ iconCss }}\"></i>`\n})\nexport class HelpComponent implements OnInit, OnChanges {\n  helper: Helper;\n  container: string;\n  iconCss: string;\n  comingSoon = HelpConstants.MESSAGE_COMING_SOON;\n  langLoading: string; // The lang in use to load the helper - for race conditions\n\n  @Input() pluginId: string; // if defined, the plugin identifier to use for fetching help content\n  @Input() key: string;\n  @Input() subKey: string;\n  @Input() placement = 'bottom';\n  @Input() dark: boolean;\n  @Input() lang: string;\n\n  constructor(private readonly helpService: HelpService, private readonly translationService: EdcTranslationService) {\n  }\n\n  ngOnInit(): void {\n    // If a lang input was provided, helper is already being loaded from ngOnChanges\n    if (this.langLoading === undefined) {\n      // No helper loading in progress from ngOnChanges, so initialize helper\n      this.initHelper();\n    }\n    this.translationService.setLang(SYS_LANG);\n    this.iconCss = this.helpService.getIcon();\n    this.container = this.helpService.getContainer();\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes['lang'] && changes['lang'].currentValue !== this.langLoading) {\n      this.initHelper();\n    }\n\n  }\n\n  private initHelper(): void {\n    if (this.key && this.subKey) {\n      this.langLoading = this.lang || null;\n      if (this.helper) {\n        // This is not the first initialization, just an update, skip timeout\n        this.loadHelper();\n      } else {\n        // Set timeout because popover content loading is not a bootstrap top priority.\n        setTimeout(this.loadHelper.bind(this), 2000);\n      }\n    }\n  }\n\n  loadHelper(): void {\n    this.helpService.getHelp(this.key, this.subKey, this.pluginId, this.lang)\n      .then((helper: Helper) => {\n        if (!helper) {\n          throw new Error(`Could not load Helper for the key ${this.key} and subKey ${this.subKey}`);\n        }\n        this.helper = helper;\n        const { language: resolvedLanguage } = helper;\n        if (resolvedLanguage !== this.lang) {\n          console.warn(`Requested language ${this.lang} could not be loaded,\n           content will be using default language ${helper.language} instead`);\n          this.lang = resolvedLanguage;\n        }\n        // Set translation language for the labels\n        this.translationService.setLang(this.lang);\n\n        this.langLoading = null;\n      })\n      .catch((err: Error) => {\n        console.error(err);\n        this.langLoading = null;\n      });\n  }\n\n  goToArticle(index: number): void {\n    const articleUrl = this.helpService.getContextUrl(this.key, this.subKey, this.lang, index);\n    this.open(articleUrl);\n  }\n\n  goToLink(link: Link): void {\n    const url = this.helpService.getDocumentationUrl(link.id);\n    this.open(url);\n  }\n\n  getPlacement(): string {\n    return this.placement;\n  }\n\n  cancelClick($event: Event): void {\n    $event.preventDefault();\n  }\n\n  private open(url: string): void {\n    window.open(url, 'help', 'scrollbars=1,resizable=1,height=800,width=1200');\n  }\n}\n","import { ModuleWithProviders, NgModule, Provider } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HelpComponent } from './help.component';\nimport { HelpService } from './help.service';\nimport { EdcTranslationService } from './translate/edc-translation.service';\n\nimport 'edc-popover-js/dist/edc-popover.css';\n\nexport interface HelpModuleConfig {\n  configLoader: Provider;\n}\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  declarations: [\n    HelpComponent,\n  ],\n  providers: [\n    HelpService,\n    EdcTranslationService,\n  ],\n  exports: [\n    HelpComponent\n  ],\n  entryComponents: [\n    HelpComponent\n  ]\n})\nexport class HelpModule {\n  static forRoot(config: HelpModuleConfig): ModuleWithProviders<HelpModule> {\n    return {\n      ngModule: HelpModule,\n      providers: [\n        HelpService,\n        config.configLoader\n      ]\n    };\n  }\n}\n","/*\n * Public API Surface of edc-popover-ng\n */\n\nexport * from './lib/help.component';\nexport * from './lib/help.module';\nexport * from './lib/help.service';\nexport * from './lib/config/popover-configuration';\nexport * from './lib/config/popover-configuration-handler';\nexport * from './lib/translate/language-codes';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n\nexport {EdcTranslationService as Éµa} from './lib/translate/edc-translation.service';"],"names":[],"mappings":"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"}