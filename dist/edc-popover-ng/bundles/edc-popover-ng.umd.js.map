{"version":3,"file":"edc-popover-ng.umd.js","sources":["../../../projects/edc-popover-ng/src/lib/config/popover-configuration-handler.ts","../../../projects/edc-popover-ng/src/lib/translate/language-codes.ts","../../../projects/edc-popover-ng/src/lib/help.service.ts","../../../projects/edc-popover-ng/src/lib/help.constants.ts","../../../projects/edc-popover-ng/src/lib/translate/edc-translation.service.ts","../../../projects/edc-popover-ng/src/lib/help.component.ts","../../../projects/edc-popover-ng/src/lib/help.module.ts","../../../projects/edc-popover-ng/src/public_api.ts","../../../projects/edc-popover-ng/src/edc-popover-ng.ts"],"sourcesContent":["\nexport abstract class PopoverConfigurationHandler {\n\n  abstract getPluginId(): string;\n\n  abstract getHelpPath(): string;\n\n  abstract getDocPath(): string;\n\n  abstract getIcon(): string;\n\n  abstract isAppendToBody(): boolean;\n\n  abstract getI18nPath(): string;\n\n}\n","export const LANGUAGE_CODES = [\n  'en', // English\n  'ar', // Arabic\n  'bg', // Bulgarian\n  'zh', // Chinese\n  'hr', // Croatian\n  'cs', // Czech\n  'da', // Danish\n  'nl', // Dutch\n  'et', // Estonian\n  'fi', // Finnish\n  'fr', // French\n  'de', // German\n  'el', // Greek\n  'he', // Hebrew\n  'hu', // Hungarian\n  'is', // Icelandic\n  'ga', // Irish\n  'it', // Italian\n  'ja', // Japanese\n  'ko', // Korean\n  'lv', // Latvian\n  'lt', // Lithuanian\n  'lb', // Luxembourgish\n  'mt', // Maltese\n  'no', // Norwegian\n  'fa', // Persian\n  'pl', // Polish\n  'pt', // Portuguese\n  'ro', // Romanian\n  'ru', // Russian\n  'sk', // Slovak\n  'sl', // Slovenian\n  'es', // Spanish\n  'sv', // Swedish\n  'tr', // Turkish\n  'vi', // Vietnamese\n];\n\n// Languages with translation contents\nexport const DEFINED_TRANSLATION_CODES = [\n  'en',\n  'fr',\n  'ru',\n  'vi',\n  'zh'\n];\n\nexport const SYS_LANG = 'en';\n","import { Injectable } from '@angular/core';\nimport { EdcClient, Helper } from 'edc-client-js';\nimport { PopoverConfigurationHandler } from './config/popover-configuration-handler';\nimport { SYS_LANG } from './translate/language-codes';\n\n@Injectable()\nexport class HelpService {\n\n  private readonly edcClient: EdcClient;\n\n  constructor(private configurationHandler: PopoverConfigurationHandler) {\n    this.edcClient = new EdcClient(configurationHandler.getDocPath(),\n      configurationHandler.getHelpPath(),\n      configurationHandler.getPluginId(),\n      true, // Context only, don't load the whole doc\n      configurationHandler.getI18nPath()\n    );\n  }\n\n  getHelp(primaryKey: string, subKey: string, pluginId?: string, lang?: string): Promise<Helper> {\n    const pluginIdentifier = pluginId || this.configurationHandler.getPluginId();\n    return this.edcClient.getHelper(primaryKey, subKey, pluginIdentifier, lang);\n  }\n\n  getContextUrl(mainKey: string, subKey: string, languageCode: string, articleIndex: number, pluginId?: string): string {\n    return this.edcClient.getContextWebHelpUrl(mainKey, subKey, languageCode, articleIndex, pluginId);\n  }\n\n  getDocumentationUrl(docId: number): string {\n    return this.edcClient.getDocumentationWebHelpUrl(docId);\n  }\n\n  getI18nUrl(): string {\n    return this.edcClient.getPopoverI18nUrl();\n  }\n\n  getPluginId(): string {\n    return this.configurationHandler.getPluginId();\n  }\n\n  getIcon(): string {\n    return this.configurationHandler.getIcon() || 'fa-question-circle-o';\n  }\n\n  getContainer(): string {\n    return this.configurationHandler.isAppendToBody() ? 'body' : '';\n  }\n\n  getDefaultLanguage(): string {\n    return (this.edcClient && this.edcClient.getDefaultLanguage && this.edcClient.getDefaultLanguage()) || SYS_LANG;\n  }\n\n  isLanguagePresent(langCode: string): boolean {\n    return this.edcClient.isLanguagePresent(langCode);\n  }\n}\n","export class HelpConstants {\n  public static readonly MESSAGE_COMING_SOON = 'Contextual help is coming soon.';\n}\n","import { HelpService } from '../help.service';\nimport { SYS_LANG } from './language-codes';\nimport { Injectable } from '@angular/core';\n\n@Injectable()\nexport class EdcTranslationService {\n\n  defaultLanguage = SYS_LANG;\n  lang = SYS_LANG;\n\n  constructor(private readonly helpService: HelpService) {\n  }\n\n  getLang(): string {\n    return this.lang;\n  }\n\n  setLang(lang: string): void {\n    this.lang = lang;\n  }\n}\n","import { Component, OnInit, Input, OnChanges, SimpleChanges } from '@angular/core';\nimport { Helper, Link } from 'edc-client-js';\nimport { HelpService } from './help.service';\nimport { HelpConstants } from './help.constants';\nimport { SYS_LANG } from './translate/language-codes';\nimport { EdcTranslationService } from './translate/edc-translation.service';\n\n@Component({\n  selector: 'edc-help',\n  styleUrls: ['help.less'],\n  template: `<i class=\"fa help-icon {{ iconCss }}\"></i>`\n})\nexport class HelpComponent implements OnInit, OnChanges {\n  helper: Helper;\n  container: string;\n  iconCss: string;\n  comingSoon = HelpConstants.MESSAGE_COMING_SOON;\n  langLoading: string; // The lang in use to load the helper - for race conditions\n\n  @Input() pluginId: string; // if defined, the plugin identifier to use for fetching help content\n  @Input() key: string;\n  @Input() subKey: string;\n  @Input() placement = 'bottom';\n  @Input() dark: boolean;\n  @Input() lang: string;\n\n  constructor(private readonly helpService: HelpService, private readonly translationService: EdcTranslationService) {\n  }\n\n  ngOnInit(): void {\n    // If a lang input was provided, helper is already being loaded from ngOnChanges\n    if (this.langLoading === undefined) {\n      // No helper loading in progress from ngOnChanges, so initialize helper\n      this.initHelper();\n    }\n    this.translationService.setLang(SYS_LANG);\n    this.iconCss = this.helpService.getIcon();\n    this.container = this.helpService.getContainer();\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes['lang'] && changes['lang'].currentValue !== this.langLoading) {\n      this.initHelper();\n    }\n\n  }\n\n  private initHelper(): void {\n    if (this.key && this.subKey) {\n      this.langLoading = this.lang || null;\n      if (this.helper) {\n        // This is not the first initialization, just an update, skip timeout\n        this.loadHelper();\n      } else {\n        // Set timeout because popover content loading is not a bootstrap top priority.\n        setTimeout(this.loadHelper.bind(this), 2000);\n      }\n    }\n  }\n\n  loadHelper(): void {\n    this.helpService.getHelp(this.key, this.subKey, this.pluginId, this.lang)\n      .then((helper: Helper) => {\n        if (!helper) {\n          throw new Error(`Could not load Helper for the key ${this.key} and subKey ${this.subKey}`);\n        }\n        this.helper = helper;\n        const { language: resolvedLanguage } = helper;\n        if (resolvedLanguage !== this.lang) {\n          console.warn(`Requested language ${this.lang} could not be loaded,\n           content will be using default language ${helper.language} instead`);\n          this.lang = resolvedLanguage;\n        }\n        // Set translation language for the labels\n        this.translationService.setLang(this.lang);\n\n        this.langLoading = null;\n      })\n      .catch((err: Error) => {\n        console.error(err);\n        this.langLoading = null;\n      });\n  }\n\n  goToArticle(index: number): void {\n    const articleUrl = this.helpService.getContextUrl(this.key, this.subKey, this.lang, index);\n    this.open(articleUrl);\n  }\n\n  goToLink(link: Link): void {\n    const url = this.helpService.getDocumentationUrl(link.id);\n    this.open(url);\n  }\n\n  getPlacement(): string {\n    return this.placement;\n  }\n\n  cancelClick($event: Event): void {\n    $event.preventDefault();\n  }\n\n  private open(url: string): void {\n    window.open(url, 'help', 'scrollbars=1,resizable=1,height=800,width=1200');\n  }\n}\n","import { ModuleWithProviders, NgModule, Provider } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HelpComponent } from './help.component';\nimport { HelpService } from './help.service';\nimport { EdcTranslationService } from './translate/edc-translation.service';\n\nimport 'edc-popover-js/dist/edc-popover.css';\n\nexport interface HelpModuleConfig {\n  configLoader: Provider;\n}\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  declarations: [\n    HelpComponent,\n  ],\n  providers: [\n    HelpService,\n    EdcTranslationService,\n  ],\n  exports: [\n    HelpComponent\n  ],\n  entryComponents: [\n    HelpComponent\n  ]\n})\nexport class HelpModule {\n  static forRoot(config: HelpModuleConfig): ModuleWithProviders<HelpModule> {\n    return {\n      ngModule: HelpModule,\n      providers: [\n        HelpService,\n        config.configLoader\n      ]\n    };\n  }\n}\n","/*\n * Public API Surface of edc-popover-ng\n */\n\nexport * from './lib/help.component';\nexport * from './lib/help.module';\nexport * from './lib/help.service';\nexport * from './lib/config/popover-configuration';\nexport * from './lib/config/popover-configuration-handler';\nexport * from './lib/translate/language-codes';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n\nexport {EdcTranslationService as Éµa} from './lib/translate/edc-translation.service';"],"names":["EdcClient","Injectable","Component","Input","NgModule","CommonModule"],"mappings":"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"}